<!DOCTYPE html>
<html lang="en">

<head>
     <meta charset="UTF-8">
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>TRNR | Reset Password</title>
     <!-- CSS only -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>

<body class="bg-light h-100">
     <nav class="navbar bg-dark">
          <div class="container-xl">
               <a class="navbar-brand text-white" href="#">TRNR</a>
          </div>
     </nav>
     <div class="row justify-content-center mt-5">
          <div class="h-100 col-lg-4 row align-content-center">
               <div class="row justify-content-center p-5 bg-white">

                    <!-- <form> -->
                    <h2>Reset your Password</h2>
                    <div class="mb-3">
                         <label for="inputPassword" class="form-label">Password</label>
                         <input type="password" id="inputPassword" class="form-control"
                              aria-describedby="passwordHelpBlock" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
                              title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters"
                              required>
                         <div id="passwordHelpBlock" class="form-text">
                              Your password must be 8-20 characters long, contain letters and numbers.
                         </div>
                    </div>
                    <div class="mb-3">
                         <label for="confirmPassword" class="form-label">Confirm Password</label>
                         <input type="password" class="form-control" id="confirmPassword">
                    </div>
                    <button class="btn btn-dark" onclick="reset()">Reset Password</button>
                    <!-- </form> -->
               </div>
          </div>
     </div>
</body>
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
     integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
     crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js">
</script>
<script>
     const params = new Proxy(new URLSearchParams(window.location.search), {
          get: (searchParams, prop) => searchParams.get(prop),
     });
     let value = params.code;
     const reset = () => {

          var p = document.getElementById("inputPassword").value;
          var cp = document.getElementById("confirmPassword").value;

          if (p !== cp) {
               alert('Password and confirm password dont match');
          }
          else if (p.length < 8 || p.length > 20) {
               alert(' Your password must be 8-20 characters long, contain letters and numbers.');
          }
          else {
               resetPassword(p, value)
          }
     }
     const body = (x, y) => ({
          password: x,
          passwordConfirmation: x,
          code: y
     })
     const resetPassword = async (x, y) => {
          try {

               await fetch('https://apiapp.trnr.com/api/auth/reset-password/', {
                    method: 'POST',
                    headers: {
                         'Accept': 'application/json',
                         'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body(x, y))
               }).then((response) => {
                    response.json().then((data) => {
                         if (data?.jwt) {
                              alert('Password Changed Successfully!')
                         }
                         else {
                              alert('Password change unsuccessfull! Try Again later.')
                         }
                    })
               }).catch((error) => console.log(error));
          }
          catch (err) {
               alert('Password change unsuccessfull! Try Again later.')
          }

     }

</script>

</html>