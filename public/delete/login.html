<!DOCTYPE html>
<html lang="en">

<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Login Form</title>
     <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.1.2/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-white flex flex-col h-screen">
     <nav class="w-full container mx-auto py-4">
          <nav class="w-full container mx-auto py-4"><img
                    src="https://trnr-app-media.s3.ap-southeast-2.amazonaws.com/Exclude_41ccaddd3d.jpg?updated_at=2023-01-07T05:56:14.068Z"
                    alt="" style="width: 100%; max-width: 120px;"></nav>
     </nav>
     <div class="flex flex-col items-center justify-center h-full container mx-auto p-4">
          <!-- ----------------------------------------------------------------------- -->
          <!--                               Login form                                -->
          <!-- ----------------------------------------------------------------------- -->
          <div id="loginForm" class="bg-white rounded-lg w-full max-w-screen-md ">
               <h2 class="text-4xl font-semibold mb-5">Login to continue</h2>
               <p class="text-gray-600">Please login to submit your account delete request.</p>
               <form id="loginForm" class="space-y-6 mt-8">
                    <div>
                         <label for="username" class="text-gray-700">Email</label>
                         <input type="text" id="username" name="username" placeholder="Username or Email"
                              class="mt-2 p-2 border border-gray-300 rounded-md w-full" required>
                    </div>
                    <div>
                         <label for="password" class="text-gray-700">Password</label>
                         <input type="password" id="password" name="password" placeholder="Password"
                              class="mt-2 p-2 border border-gray-300 rounded-md w-full" required>
                    </div>
                    <button type="submit" id="loginBtn"
                         class="w-fit bg-gray-900 text-white py-2 px-16 rounded-full hover:bg-gray-700 transition-colors relative">
                         Login
                         <span id="spinner" class="hidden absolute right-0 inset-y-0 pr-3 flex items-center">
                              <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg"
                                   fill="none" viewBox="0 0 24 24">
                                   <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        strokeWidth="4"></circle>
                                   <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 0116 0H4z"></path>
                              </svg>
                         </span>
                    </button>
               </form>
          </div>
          <!-- ----------------------------------------------------------------------- -->
          <!--                               Delete Form                               -->
          <!-- ----------------------------------------------------------------------- -->
          <div id="deleteForm" class="bg-white  rounded-lg  w-full max-w-screen-md">
               <h2 class="text-4xl font-semibold mb-5">Delete Account</h2>
               <p class="text-gray-600">Lorem ipsum dolor sit,
                    amet consectetur adipisicing elit. Itaque porro nobis,
                    facere laboriosam natus animi quis eum? Possimus,
                    velit voluptatum,
                    quaerat debitis quos ullam beatae sed ducimus,
                    dignissimos esse earum.</p>
               <form id="deleteAccountForm" class="space-y-12 mt-8">
                    <fieldset>
                         <legend class="text-gray-700">Please select an appropriate reason for leaving:</legend>
                         <div class="space-y-2 mt-4">
                              <label class="flex items-center">
                                   <input type="radio" name="deleteReason" value="No Longer Using the Platform"
                                        class="form-radio h-5 w-5 text-blue-600 accent-gray-500"><span class="ml-2">No
                                        Longer Using the
                                        Platform</span>
                              </label>
                              <label class="flex items-center">
                                   <input type="radio" name="deleteReason" value="Privacy Concerns"
                                        class="form-radio h-5 w-5 text-blue-600">
                                   <span class="ml-2">Privacy
                                        Concerns</span>
                              </label>
                              <label class="flex items-center">

                                   <input type="radio" name="deleteReason" value="Security Concerns"
                                        class="form-radio h-5 w-5 text-blue-600"><span class="ml-2">Security
                                        Concerns</span>
                              </label>
                              <label class="flex items-center">
                                   <input type="radio" name="deleteReason" value="Unsatisfactory Experience"
                                        class="form-radio h-5 w-5 text-blue-600">
                                   <span class="ml-2">Unsatisfactory
                                        Experience</span>
                              </label>
                              <label class="flex items-center">
                                   <input type="radio" name="deleteReason" value="Concerns About Content or Community"
                                        class="form-radio h-5 w-5 text-blue-600">
                                   <span class="ml-2">Concerns About
                                        Content or Community</span>
                              </label>
                              <label class="flex items-center">
                                   <input type="radio" name="deleteReason" value="Other"
                                        class="form-radio h-5 w-5 text-blue-600" id="otherOption">
                                   <span class="ml-2">Other</span>
                              </label>
                              <textarea type="text" id="otherReasonInput" name="otherReason"
                                   placeholder="Please specify reason for leaving ...  (Optional)"
                                   class="mt-2 p-2 border border-gray-300 rounded-md w-full hidden"></textarea>
                         </div>
                    </fieldset>
                    <button type="submit" id="deleteBtn"
                         class="w-fit bg-gray-900 text-white py-2 px-16 rounded-full hover:bg-gray-700 transition-colors relative">
                         Delete Account
                         <span id="spinner" class="hidden absolute right-0 inset-y-0 pr-3 flex items-center">
                              <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg"
                                   fill="none" viewBox="0 0 24 24">
                                   <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        strokeWidth="4"></circle>
                                   <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 0116 0H4z"></path>
                              </svg>
                         </span>
                    </button>
               </form>
          </div>
     </div>
     <div id="snackbar" class="fixed bottom-5 right-5 bg-gray-800 text-white px-6 py-3 rounded-md hidden">Your account
          has been successfully deleted.</div>
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
     <script>
          // Hide delete form initially
          $('#deleteForm').hide();
          // ----------------------------------------------------------------------- -->
          //                          Login form submission                          -->
          // ----------------------------------------------------------------------- -->
          $('#loginBtn').click(function async() {
               const email = $('#username').val();
               const password = $('#password').val();
               // Show spinner
               $('#spinner').removeClass('hidden');
               $(this).prop('disabled', true);

               fetch('http://localhost:1337/api/auth/local/', {
                    method: 'POST',
                    headers: {
                         'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ identifier: email, password: password })
               })
                    .then(response => response.json())
                    .then(data => {
                         localStorage.setItem('jwtToken', data.jwt);
                         if (data.jwt) {
                              console.log('JWT Token:', data.jwt);
                              // Hide spinner
                              $('#spinner').addClass('hidden');
                              $('#loginBtn').prop('disabled', false);

                              // Update snackbar text and show it
                              $('#snackbar').text('Login successful!').removeClass('hidden').addClass('block').delay(3000).fadeOut(400);

                              // Hide login form and show delete form
                              $('#loginForm').hide();
                              $('#deleteForm').show();
                         }
                         else {
                              $('#spinner').addClass('hidden');
                              $('#loginBtn').prop('disabled', false);

                              // Update snackbar text and show it
                              $('#snackbar').text('Login failed. Please try again.').removeClass('hidden').removeClass('bg-gray-800').addClass('block').addClass('bg-red-800').delay(3000).fadeOut(400).removeClass('bg-red-800').addClass('bg-gray-800');
                         }

                    })
                    .catch(error => {
                         console.error('Error:', error); // Hide spinner
                         $('#spinner').addClass('hidden');
                         $('#loginBtn').prop('disabled', false);

                         // Update snackbar text and show it
                         $('#snackbar').text('Login failed. Please try again.').removeClass('hidden').removeClass('bg-gray-800').addClass('block').addClass('bg-red-800').delay(3000).fadeOut(400);

                    });
          });
          // ----------------------------------------------------------------------- -->
          //                           Delete Button Click                           -->
          // ----------------------------------------------------------------------- -->
          $('#deleteBtn').click(function () {
               // Get the value of the checked radio button
               var selectedReason = $('input[name="deleteReason"]:checked').val();
               console.log("Selected reason for leaving: ", selectedReason);

               // Check if 'Other' is selected and get the textarea value
               if (selectedReason === "Other") {
                    var otherReason = $("#otherReasonInput").val();
                    console.log("Other reason specified: ", otherReason);
               }
               // const email = $('#username').val();
               // const password = $('#password').val();
               // Show spinner
               $('#spinner').removeClass('hidden');
               $(this).prop('disabled', true);
               var jwtToken = localStorage.getItem('jwtToken');
               fetch('http://localhost:1337/api/delete', {
                    method: 'POST',
                    headers: {
                         'Content-Type': 'application/json',
                         'Authorization': 'Bearer ' + localStorage.getItem('jwtToken')
                    },
                    body: JSON.stringify({ reason: selectedReason, explanation: otherReason })
               })
                    .then(response => response.json())
                    .then(data => {
                         // jwtToken = data.message;
                         if (data.message === 'success') {
                              // Hide spinner
                              $('#spinner').addClass('hidden');
                              $('#loginBtn').prop('disabled', false);

                              // Update snackbar text and show it
                              $('#snackbar').text('Login successful!').removeClass('hidden').addClass('block').delay(3000).fadeOut(400);

                              // Hide login form and show delete form
                              $('#loginForm').hide();
                              $('#deleteForm').show();
                         }
                         else {
                              $('#spinner').addClass('hidden');
                              $('#loginBtn').prop('disabled', false);

                              // Update snackbar text and show it
                              $('#snackbar').text('Login failed. Please try again.').removeClass('hidden').removeClass('bg-gray-800').addClass('block').addClass('bg-red-800').delay(3000).fadeOut(400).removeClass('bg-red-800').addClass('bg-gray-800');
                         }

                    })
                    .catch(error => {
                         console.error('Error:', error); // Hide spinner
                         $('#spinner').addClass('hidden');
                         $('#loginBtn').prop('disabled', false);

                         // Update snackbar text and show it
                         $('#snackbar').text('Login failed. Please try again.').removeClass('hidden').removeClass('bg-gray-800').addClass('block').addClass('bg-red-800').delay(3000).fadeOut(400);

                    });
          });
          // Optional JavaScript for form submission handling
          $(document).ready(function () {
               $('#loginForm').submit(function (e) {
                    e.preventDefault();
                    // Add form submission logic here
                    // For demonstration, just log username and password to the console
                    console.log('Username:', $('#username').val());
                    console.log('Password:', $('#password').val());
                    // Redirect or show login success message
               });
          });
     </script>
</body>

</html>